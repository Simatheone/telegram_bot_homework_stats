## Телеграмм Бот ассистент :robot:

## Оглавление
- [Используемые технологии](#используемые-технологии)
- [Описание проекта](#описание-проекта)
- [Пример заполнения .env файла](#пример-заполнения-env-файла)
- [Запуск проекта](#запуск-проекта)

## Используемые технологии
:snake: Python 3.8, :incoming_envelope: requests, :space_invader:	python-telegram-bot

## Описание проекта
Телеграм бот помогает отслеживать статус домашних работ, отправленных на ревью во время обучения на платформе [YandexPracticum](https://practicum.yandex.ru/).
Раз в 10 минут бот опрашивать API сервиса Практикум.Домашка и проверять статус отправленной на ревью домашней работы.
При обновлении статуса бот анализирует ответ от API и отправляет соответствующее уведомление в Telegram.
Бот логирует свою работу и сообщает о важных проблемах сообщением в Telegram.

<details><summary>Подробнее о работе Телграмм бота:</summary>
<p>

### Основные функции работы бота

Функция ```check_tokens()``` проверяет доступность переменных окружения, которые необходимы для работы программы. Если отсутствует хотя бы одна переменная окружения — функция возвращает False, иначе — True.

Функция ```get_api_answer()``` делает запрос к единственному эндпоинту API-сервиса. В качестве параметра функция получает временную метку. В случае успешного запроса возвращает ответ API, преобразовав его из формата JSON к типам данных Python.

Функция ```check_response()``` проверяет ответ API на корректность. В качестве параметра функция получает ответ API, приведенный к типам данных Python. Если ответ API соответствует ожиданиям, то функция возвращает список домашних работ (он может быть и пустым), доступный в ответе API по ключу 'homeworks'.

Функция ```parse_status()``` извлекает из информации о конкретной домашней работе статус этой работы. В качестве параметра функция получает только один элемент из списка домашних работ. В случае успеха, функция возвращает подготовленную для отправки в Telegram строку, содержащую один из вердиктов словаря HOMEWORK_STATUSES.

Функция ```send_message()``` отправляет сообщение в Telegram чат, определяемый переменной окружения TELEGRAM_CHAT_ID. Принимает на вход два параметра: экземпляр класса Bot и строку с текстом сообщения.

Функция ```main()```: в ней описана основная логика работы программы. Все остальные функции запускаются из неё.
Последовательность действий:
  - Сделать запрос к API - ```get_api_answer()```;
  - Проверить ответ от API - ```check_response()```;
  - Если есть обновления — получить статус работы из обновления - ```parse_status()```;
  - Отправить сообщение в Telegram - ```send_message()```;
  - Подождать некоторое время и сделать новый запрос - ```time.sleep(RETRY_TIME)```.
---

### Логирование

Каждое сообщение в журнале логов состоит из:
  - даты и времени события;
  - уровня важности события;
  - описания события.

```bash
Пример:

2021-10-09 15:34:45,150 [ERROR] Сбой в работе программы: Эндпоинт https://practicum.yandex.ru/api/user_api/homework_statuses/111 недоступен. Код ответа API: 404
2021-10-09 15:34:45,355 [INFO] Бот отправил сообщение "Сбой в работе программы: Эндпоинт [https://practicum.yandex.ru/api/user_api/homework_statuses/](https://practicum.yandex.ru/api/user_api/homework_statuses/) недоступен. Код ответа API: 404"
```

Логируются такие события:
  - отсутствие обязательных переменных окружения во время запуска бота, уровень **CRITICAL**.
  - удачная отправка любого сообщения в Telegram, уровень **INFO**;
  - сбой при отправке сообщения в Telegram, уровень **ERROR**;
  - недоступность эндпоинта https://practicum.yandex.ru/api/user_api/homework_statuses/, уровень **ERROR**;
  - любые другие сбои при запросе к эндпоинту, уровень **ERROR**;
  - отсутствие ожидаемых ключей в ответе API, уровень **ERROR**;
  - недокументированный статус домашней работы, обнаруженный в ответе API, уровень **ERROR**;
  - отсутствие в ответе новых статусов, уровень **DEBUG**.

События уровня **ERROR** не только логируются, но и пересылаются Telegram в тех случаях, когда это технически возможно.

Если при каждой попытке бота получить и обработать информацию от API ошибка повторяется, в телеграмм отправляется сообщение 1 раз.

При этом в логи записывается информацию о каждой неудачной попытке.

[:top: Вернуться к оглавлению](#оглавление)
  
</p>
</details>


## Пример заполнения .env файла

Для корретной работы бота необходимо создать файл ```.env``` и заполнить переменные окружения.

```PRACTICUM_TOKEN=YourPracticumToken```

```TELEGRAM_TOKEN=YourTelegramToken``` 

```TELEGRAM_CHAT_ID=YourTelegramChatID```

<details><summary>Подробнее о том где получить токены:</summary>
<p>

```PRACTICUM_TOKEN``` - можно получить по [адресу](https://oauth.yandex.ru/authorize?response_type=token&client_id=1d0b9dd4d652455a9eb710d450ff456a), если вы студент YandexPracticum.

```TELEGRAM_TOKEN``` - токен бота, который можно получить через главного бота телеграм **@Botfather**. Подробности работы с ботом **@Botfather** [ТУТ](https://core.telegram.org/bots).

```TELEGRAM_CHAT_ID=YourTelegramChatID``` - чат айди можно получить у бота **@userinfobot**.

[:top: Вернуться к оглавлению](#оглавление)  

</p>
</details>


## Запуск проекта
1. Клонировать репозиторий:
```bash
git clone https://github.com/Simatheone/telegram_bot_homework_stats.git
```

2. Создать виртуальное окружение:
```bash
python3 -m venv venv
```

3. Активировать виртуальное окружение и установить зависимости из ```requirements.txt```:
```bash
bash/zsh:
source venv/bin/activate

Windows:
venv\Scripts\activate.bat
```

```bash
pip install -r requirements.txt
```

4. Запустить ```homework.py```:
```bash
python3 homework.py
```
